<!DOCTYPE html>
<html>
<head>
  <title>Magic Spell Game</title>
  <style>
    #game { max-width: 400px; margin: auto; text-align: center; }
    .map { font-family: monospace; margin-bottom: 10px; }
    .enemy { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div id="game">
    <h2>Magic Spell Game</h2>
    <div id="map" class="map"></div>
    <div id="location"></div>
    <div>
      <button onclick="move('north')">North</button><br>
      <button onclick="move('west')">West</button>
      <button onclick="move('east')">East</button><br>
      <button onclick="move('south')">South</button>
    </div>
    <p>
      <input id="spellInput" placeholder="Cast a spell" />
      <button onclick="castSpell()">Cast</button>
    </p>
    <div id="output"></div>
  </div>

  <script>
    let player = { x: 0, y: 0 };
    const mapSize = 5;

    let enemies = [
      { name: "Goblin", x: 2, y: 2, hp: 3 },
      { name: "Wraith", x: 4, y: 1, hp: 2 }
    ];

    function move(dir) {
      if (dir === 'north') player.y--;
      if (dir === 'south') player.y++;
      if (dir === 'west')  player.x--;
      if (dir === 'east')  player.x++;
      player.x = Math.max(0, Math.min(mapSize - 1, player.x));
      player.y = Math.max(0, Math.min(mapSize - 1, player.y));
      enemyChase();
      updateGame();
    }

    function castSpell() {
      const spell = document.getElementById("spellInput").value.toLowerCase().trim();
      let foundEnemy = enemies.find(e => e.x === player.x && e.y === player.y);
      if (foundEnemy) {
        if (spell.includes("fire") || spell.includes("zap")) {
          foundEnemy.hp--;
          print(`You hit the ${foundEnemy.name} with ${spell}! HP left: ${foundEnemy.hp}`);
          if (foundEnemy.hp <= 0) {
            enemies = enemies.filter(e => e !== foundEnemy);
            print(`You defeated the ${foundEnemy.name}!`);
          }
        } else {
          print(`Your spell had no effect. The ${foundEnemy.name} strikes back!`);
        }
      } else {
        print(`Nothing happens. No enemy here.`);
      }
    }

    function enemyChase() {
      enemies.forEach(e => {
        let dx = player.x - e.x;
        let dy = player.y - e.y;
        if (Math.abs(dx) > Math.abs(dy)) {
          e.x += Math.sign(dx);
        } else {
          e.y += Math.sign(dy);
        }
      });
    }

    function updateGame() {
      document.getElementById("location").textContent = `You are at (${player.x}, ${player.y})`;
      let nearby = enemies.filter(e =>
        Math.abs(e.x - player.x) <= 1 && Math.abs(e.y - player.y) <= 1
      );
      let here = enemies.find(e => e.x === player.x && e.y === player.y);
      let msg = "";
      if (here) {
        msg += `<p class="enemy">‚öîÔ∏è You have encountered a ${here.name}!</p>`;
      } else if (nearby.length > 0) {
        msg += `<p class="enemy">‚ö†Ô∏è You sense danger nearby...</p>`;
      }
      renderMap();
      print(msg, true);
    }

    function renderMap() {
      let map = "";
      for (let y = 0; y < mapSize; y++) {
        for (let x = 0; x < mapSize; x++) {
          if (player.x === x && player.y === y) {
            map += "üßô ";
          } else if (enemies.find(e => e.x === x && e.y === y)) {
            map += "üëπ ";
          } else {
            map += "‚¨ú ";
          }
        }
        map += "<br>";
      }
      document.getElementById("map").innerHTML = map;
    }

    function print(msg, replace = false) {
      let output = document.getElementById("output");
      if (replace) output.innerHTML = msg;
      else output.innerHTML += `<p>${msg}</p>`;
    }

    updateGame();
  </script>
</body>
</html>
