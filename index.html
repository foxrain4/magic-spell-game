<!DOCTYPE html>
<html>
<head>
  <title>Magic Spell Game</title>
  <style>
    body { font-family: monospace; background: black; color: lime; padding: 20px; }
    #minimap { margin-bottom: 10px; }
    .npc { color: cyan; }
    .location { font-weight: bold; }
    .locked { color: gray; }
  </style>
</head>
<body>
  <div id="minimap"></div>
  <div class="location" id="location"></div>
  <div id="output"></div>
  <input id="spellInput" placeholder="Type a spell or direction..." autofocus>
  <script>
    const map = {
      '0,0': 'a garden with silver trees',
      '0,1': 'a quiet library',
      '1,0': 'a shimmering pool',
      '1,1': 'a castle courtyard',
      '-1,0': 'a dusty tower',
      '0,-1': 'a field with floating stones',
    };

    const specialEvents = {
      '0,0': { keyword: 'grow', message: 'A tiny tree sprouts beside you. The dryad smiles.' },
      '0,1': { keyword: 'read', message: 'The librarian ghost nods. You understand the forbidden text.' },
      '1,0': { keyword: 'splash', message: 'A water spirit rises. "Thank you for waking me."' },
      '1,1': { keyword: 'bow', message: 'The guard kneels. "You are worthy."' },
      '-1,0': { keyword: 'clean', message: 'The dust lifts. A voice echoes: "My tower is restored."' },
      '0,-1': { keyword: 'fly', message: 'You hover among the stones. A wind voice whispers approval.' }
    };

    const inventory = [];
    let position = { x: 0, y: 0 };
    const visited = new Set();
    const npcsHelped = [];
    let gameEnded = false;

    const endings = [
      "You vanish in a flash of light, forgotten by the world.",
      "You become a wandering spirit, searching for purpose.",
      "You awaken in a hidden sanctuary, welcomed as an apprentice.",
      "You are crowned a protector of realms unknown.",
      "You ascend into myth, your story whispered in every shadow."
    ];

    function updateUI() {
      const key = `${position.x},${position.y}`;
      visited.add(key);
      const locationText = map[key] || "a mysterious fog";
      document.getElementById('location').textContent = `You are in ${locationText}.`;
      document.getElementById('minimap').textContent = `Visited: ${[...visited].join(' | ')}`;
    }

    function updateInventory() {
      document.getElementById('output').textContent = `Inventory: ${inventory.join(', ') || 'empty'}`;
    }

    function castSpell(input) {
      if (gameEnded) return;

      input = input.toLowerCase().trim();
      const key = `${position.x},${position.y}`;

      if (['north', 'south', 'east', 'west'].includes(input)) {
        if (input === 'north') position.y += 1;
        if (input === 'south') position.y -= 1;
        if (input === 'east') position.x += 1;
        if (input === 'west') position.x -= 1;
        updateUI();
        return;
      }

      if (specialEvents[key] && specialEvents[key].keyword === input) {
        if (!npcsHelped.includes(key)) {
          npcsHelped.push(key);
        }
        document.getElementById('output').textContent = specialEvents[key].message;
        return;
      }

      if (input === 'ascend') {
        let endingText = "";
        const count = npcsHelped.length;
        const index = Math.min(count, endings.length - 1);
        endingText = endings[index] + `\nYou achieved Ending ${index + 1} of ${endings.length}.`;
        document.getElementById('output').textContent = endingText;
        gameEnded = true;
        return;
      }

      inventory.push(input);
      updateInventory();
    }

    document.getElementById('spellInput').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        castSpell(e.target.value);
        e.target.value = '';
      }
    });

    updateUI();
  </script>
</body>
</html>
